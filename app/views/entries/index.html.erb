<% provide(:title, 'Badger - Entries for ' + session[:company]) %>

<legend>Entries for <%= session[:company] %></legend>
  <div>
    <% if @entries.length == 0 %>
      <p>No entries here</p>
    <% else %>
      <div class="table-responsive">
      <table class="table table-condensed table-striped table-hover">
        <thead>
          <tr>
            <th>Number</th>
            <th>Appliance</th>
            <th>Brand</th>
            <th>Type</th>
            <th>Serial</th>
            <th>Status</th>
            <th style="width:17px;"></th>
            <% if can? :zip, Entry %>
              <th style="width:17px;"></th>
            <% end %>
            <% if can? :edit, Entry %>
              <th style="width:17px;"></th>
              <th style="width:17px;"></th>
            <% end %>
            <% if can? :destroy, Entry %>
              <th style="width:17px;"></th>
            <% end %>
          </tr>
        </thead>
        <tbody class="searchable">
          <% @entries.each do |entry| %>
            <tr>
              <td><%= entry.company[0].upcase! + @appliances[entry.appliance_id - 1].abb + entry.number %></td>
              <td><%= @appliances[entry.appliance_id - 1].name %></td>
              <td><%= entry.brand %></td>
              <td><%= entry.typenum %></td>
              <td><%= entry.serialnum %></td>
              <td><%= entry.status %></td>
              <% if can? :zip, Entry %>
                <td>
                <% unless entry.attachments.length == 0 %>
                  <%= link_to zip_path(entry) do %>
                    <span class="glyphicon glyphicon-picture"></span>
                  <% end %>
                <% end %>
                </td>
              <% end %>
              <td>
                <%= link_to entry_path(entry) do %>
                  <span class="glyphicon glyphicon-search"></span>
                <% end %>
              </td>
              <% if can? :edit, Entry %>
                <td data-no-turbolink>
                  <%= link_to sticker_path(entry) do %>
                    <span class="glyphicon glyphicon-barcode"></span>
                  <% end %>
                </td>
                <td>
                  <%= link_to edit_entry_path(entry) do %>
                    <span class="glyphicon glyphicon-pencil"></span>
                  <% end %>
                </td>
              <% end %>
              <% if can? :destroy, Entry %>
                <td>
                  <%= link_to(entry_path(entry), :data => { :confirm => "Are you sure?" }, :method => :delete) do %>
                    <span class="glyphicon glyphicon-remove"></span>
                  <% end %>
                </td>
              <% end %>
            </tr>
          <% end %>
        </tbody>
      </table>
      </div>

      <% if @pagination %>
        <%= paginate @entries %>
      <% end %>
    <% end %>

    <% unless @pagination %>
      <%= link_to('Back to overview', entries_path(company: session[:company]), :class => 'btn btn-mini btn-primary') %>
      <br>
      <br>
    <% end %>
  </div>
  <div>
  <% if can? :create, Entry %>
    <%= link_to("Add entry", new_entry_path, :class => 'btn btn-mini btn-primary') %>
  <% end %>

  <% if @pagination %>
    <!-- Button trigger modal -->
    <button class="btn btn-mini btn-primary" data-toggle="modal" data-target="#modal-search">
      Search
    </button>

    <!-- Modal -->
    <div class="modal fade" id="modal-search" tabindex="-1" role="dialog" aria-labelledby="modalLabel-search" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title" id="modalLabel-search">Search</h4>
          </div>
          <div class="modal-body">
            <%= form_tag entries_path,:class => "navbar-form", :method => 'get' do %>
                <p>  
                  <%= text_field_tag :searchnum, params[:searchnum], :placeholder => 'Search number..' %>
                  <input id="company" name="company" type="hidden" value="<%= params[:company] %>" />
                  <%= submit_tag "Search", :name => nil, :class => 'btn btn-mini btn-primary', :style => 'height:28px' %>  
                </p>  
              <% end %>
              <%= form_tag entries_path,:class => "navbar-form", :method => 'get' do %>
                <p>  
                  <%= text_field_tag :searchbrand, params[:searchbrand], :placeholder => 'Search brand..' %>
                  <input id="company" name="company" type="hidden" value="<%= params[:company] %>" />
                  <%= submit_tag "Search", :name => nil, :class => 'btn btn-mini btn-primary', :style => 'height:28px' %>  
                </p>  
              <% end %>
              <%= form_tag entries_path,:class => "navbar-form", :method => 'get' do %>
                <p>  
                  <%= text_field_tag :searchtype, params[:searchtype], :placeholder => 'Search type..' %>
                  <input id="company" name="company" type="hidden" value="<%= params[:company] %>" />
                  <%= submit_tag "Search", :name => nil, :class => 'btn btn-mini btn-primary', :style => 'height:28px' %>  
                </p>  
              <% end %>
              <%= form_tag entries_path,:class => "navbar-form", :method => 'get' do %>
                <p>  
                  <%= text_field_tag :searchserial, params[:searchserial], :placeholder => 'Search serial..' %>
                  <input id="company" name="company" type="hidden" value="<%= params[:company] %>" />
                  <%= submit_tag "Search", :name => nil, :class => 'btn btn-mini btn-primary', :style => 'height:28px' %>  
                </p>  
              <% end %>
              <%= form_tag entries_path,:class => "navbar-form", :method => 'get' do %>
                <p>  
                  <%= select_tag :searchstatus, options_for_select(@statuses) %>
                  <input id="company" name="company" type="hidden" value="<%= params[:company] %>" />
                  <%= submit_tag "Search", :name => nil, :class => 'btn btn-mini btn-primary', :style => 'height:28px' %>  
                </p>  
              <% end %>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
  <% end %>
